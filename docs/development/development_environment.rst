Development Environment
=======================

Currently, this package serves as an interface to the cpp binaries of k-Wave.
For this reason, are required to run simulations with `k-Wave-python`.
The binaries are downloaded by k-Wave-python when the package is run for the first time.

To correctly set up your development environment for this repository, clone the repository from github, and install the project dependencies.

.. code-block:: bash

    git clone https://github.com/waltsims/k-wave-python
    cd k-wave-python
    pip install -e '.[dev]'

Test References
=======================

Test compare the output of the python interface to the output of the matlab interface.
These tests are located in the ``tests`` directory. The comparison between ``matlab`` and ``python`` outputs are done in two ways:

- Unit-testing: k-Wave-python functions that have a direct counterpart in original k-Wave are tested by comparing the outputs of the two functions.
 The output of the original k-Wave functions are stored in ``.mat`` files.
 These files can be generated by running the corresponding MATLAB scripts located in the ``tests/matlab_test_data_collectors/matlab_collectors/`` directory by running ``tests/matlab_test_data_collectors/run_all_collectors.m``.
 After running the scripts, the reference files can be found in ``tests/matlab_test_data_collectors/python_testes/collectedValues/``.
 
.. note::
    If you do not have MATLAB installed to generate the reference files, you can download recently generated reference file outputs from the GitHub CI and place them in the python_testers/collectedValues/ directory.
    The latest reference files can be found in the artifacts of the latest CI run of ``pytest.yml``.

- Integration testing: k-Wave-python tests output .h5 files that are passed to the k-Wave binaries and ensures that they match the output of the original k-Wave.
  This testing compares the output for many of the example scripts from the original k-Wave package.
  Hash values of the reference output .h5 file from MATLAB examples are generated and stored in ``.json`` files in ``tests/reference_outputs/``.
  This .json files are contained in the code repository and do not need to be generated.
  Since these files are generated from the original k-Wave package, they only need to be updated when a new release of k-Wave is made.

<TODO: @farid How to regenerate theses outputs?>

To run the tests, use the following command:    

.. code-block:: bash
    pytest 

